<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health & Fitness Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 5px;
            backdrop-filter: blur(10px);
        }

        .nav-tab {
            background: transparent;
            border: none;
            color: white;
            padding: 12px 24px;
            margin: 0 5px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .nav-tab.active, .nav-tab:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h3 {
            color: #5a67d8;
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #2d3748;
            margin: 10px 0;
        }

        .metric-label {
            font-size: 0.9rem;
            color: #718096;
            margin-bottom: 5px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #4a5568;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #5a67d8;
        }

        .btn {
            background: linear-gradient(135deg, #5a67d8, #667eea);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(90, 103, 216, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #718096, #4a5568);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e53e3e, #c53030);
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-top: 20px;
        }

        .data-import {
            background: rgba(255,255,255,0.1);
            border: 2px dashed rgba(255,255,255,0.3);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .data-import h3 {
            margin-bottom: 15px;
            color: white;
        }

        .progress-ring {
            width: 120px;
            height: 120px;
            margin: 0 auto 15px;
        }

        .progress-ring circle {
            stroke: #5a67d8;
            stroke-width: 8;
            fill: transparent;
            stroke-dasharray: 283;
            stroke-dashoffset: 283;
            transition: stroke-dashoffset 0.5s ease;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }

        .correlations {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .correlation-item {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .correlation-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .positive { color: #48bb78; }
        .negative { color: #f56565; }
        .neutral { color: #ed8936; }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }

        .data-table th, .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .data-table th {
            background: #f7fafc;
            font-weight: 600;
            color: #4a5568;
        }

        .export-options {
            margin-top: 20px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
        }

        @media (max-width: 768px) {
            .container { padding: 15px; }
            .header h1 { font-size: 2rem; }
            .nav-tabs { flex-wrap: wrap; }
            .dashboard-grid { grid-template-columns: 1fr; }
            .chart-container { height: 300px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÉ‚Äç‚ôÇÔ∏è Health & Fitness Dashboard</h1>
            <p>Track your journey to better health</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
            <button class="nav-tab" onclick="showTab('entry')">‚úèÔ∏è Data Entry</button>
            <button class="nav-tab" onclick="showTab('import')">üì± Data Import</button>
            <button class="nav-tab" onclick="showTab('analytics')">üìà Analytics</button>
            <button class="nav-tab" onclick="showTab('export')">üíæ Export</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="dashboard-grid">
                <div class="card">
                    <h3>‚öñÔ∏è Current Weight</h3>
                    <div class="metric-value" id="currentWeight">-- kg</div>
                    <div class="metric-label">Last updated: <span id="weightDate">--</span></div>
                    <canvas id="weightChart" style="max-height: 200px;"></canvas>
                </div>

                <div class="card">
                    <h3>üëü Daily Steps</h3>
                    <div class="metric-value" id="todaySteps">--</div>
                    <div class="metric-label">Goal: 10,000 steps</div>
                    <div class="progress-ring">
                        <svg width="120" height="120">
                            <circle cx="60" cy="60" r="45" id="stepsProgress"></circle>
                        </svg>
                    </div>
                </div>

                <div class="card">
                    <h3>üò¥ Sleep Quality</h3>
                    <div class="metric-value" id="lastSleep">-- hrs</div>
                    <div class="metric-label">Last night</div>
                    <div class="metric-label">Avg: <span id="avgSleep">-- hrs</span></div>
                </div>

                <div class="card">
                    <h3>üî• Calories Today</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="metric-label">Consumed</div>
                            <div class="metric-value" style="font-size: 1.2rem;" id="caloriesIn">--</div>
                        </div>
                        <div class="stat-item">
                            <div class="metric-label">Burned</div>
                            <div class="metric-value" style="font-size: 1.2rem;" id="caloriesOut">--</div>
                        </div>
                    </div>
                    <div class="metric-label">Net: <span id="netCalories">--</span></div>
                </div>
            </div>

            <div class="card">
                <h3>üìä Weekly Overview</h3>
                <div class="chart-container">
                    <canvas id="weeklyChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Data Entry Tab -->
        <div id="entry" class="tab-content">
            <div class="dashboard-grid">
                <div class="card">
                    <h3>‚öñÔ∏è Weight Entry</h3>
                    <div class="form-group">
                        <label for="weightInput">Weight (kg)</label>
                        <input type="number" id="weightInput" step="0.1" placeholder="Enter your weight">
                    </div>
                    <div class="form-group">
                        <label for="weightDate">Date</label>
                        <input type="date" id="weightDateInput">
                    </div>
                    <button class="btn" onclick="addWeight()">Add Weight</button>
                </div>

                <div class="card">
                    <h3>üëü Activity Entry</h3>
                    <div class="form-group">
                        <label for="stepsInput">Steps</label>
                        <input type="number" id="stepsInput" placeholder="Daily steps">
                    </div>
                    <div class="form-group">
                        <label for="sleepInput">Sleep Hours</label>
                        <input type="number" id="sleepInput" step="0.5" placeholder="Hours of sleep">
                    </div>
                    <div class="form-group">
                        <label for="activityDate">Date</label>
                        <input type="date" id="activityDate">
                    </div>
                    <button class="btn" onclick="addActivity()">Add Activity</button>
                </div>

                <div class="card">
                    <h3>üçΩÔ∏è Nutrition Entry</h3>
                    <div class="form-group">
                        <label for="caloriesInput">Calories</label>
                        <input type="number" id="caloriesInput" placeholder="Total calories">
                    </div>
                    <div class="form-group">
                        <label for="proteinInput">Protein (g)</label>
                        <input type="number" id="proteinInput" placeholder="Protein grams">
                    </div>
                    <div class="form-group">
                        <label for="carbsInput">Carbs (g)</label>
                        <input type="number" id="carbsInput" placeholder="Carbs grams">
                    </div>
                    <div class="form-group">
                        <label for="fatInput">Fat (g)</label>
                        <input type="number" id="fatInput" placeholder="Fat grams">
                    </div>
                    <div class="form-group">
                        <label for="nutritionDate">Date</label>
                        <input type="date" id="nutritionDate">
                    </div>
                    <button class="btn" onclick="addNutrition()">Add Nutrition</button>
                </div>

                <div class="card">
                    <h3>üí™ Workout Entry</h3>
                    <div class="form-group">
                        <label for="workoutType">Workout Type</label>
                        <select id="workoutType">
                            <option value="cardio">Cardio</option>
                            <option value="strength">Strength Training</option>
                            <option value="yoga">Yoga</option>
                            <option value="cycling">Cycling</option>
                            <option value="running">Running</option>
                            <option value="swimming">Swimming</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="workoutDuration">Duration (minutes)</label>
                        <input type="number" id="workoutDuration" placeholder="Workout duration">
                    </div>
                    <div class="form-group">
                        <label for="caloriesBurned">Calories Burned</label>
                        <input type="number" id="caloriesBurned" placeholder="Calories burned">
                    </div>
                    <div class="form-group">
                        <label for="workoutDate">Date</label>
                        <input type="date" id="workoutDate">
                    </div>
                    <button class="btn" onclick="addWorkout()">Add Workout</button>
                </div>
            </div>
        </div>

        <!-- Data Import Tab -->
        <div id="import" class="tab-content">
            <div class="data-import">
                <h3>üì± Apple Health Data</h3>
                <p>To import data from Apple Health:</p>
                <ol style="text-align: left; max-width: 600px; margin: 20px auto;">
                    <li>Open the Health app on your iPhone</li>
                    <li>Tap your profile picture ‚Üí Export All Health Data</li>
                    <li>Save the export.xml file to your device</li>
                    <li>Use the file input below to import</li>
                </ol>
                <input type="file" id="appleHealthFile" accept=".xml" onchange="handleAppleHealthImport(event)">
                <button class="btn" onclick="document.getElementById('appleHealthFile').click()">Choose Apple Health File</button>
            </div>

            <div class="data-import">
                <h3>üçΩÔ∏è Nutrition Data</h3>
                <p>Import CSV data from nutrition apps (MyFitnessPal, Cronometer, etc.)</p>
                <p>Expected format: Date, Calories, Protein, Carbs, Fat</p>
                <input type="file" id="nutritionFile" accept=".csv" onchange="handleNutritionImport(event)">
                <button class="btn" onclick="document.getElementById('nutritionFile').click()">Choose Nutrition File</button>
            </div>

            <div class="card">
                <h3>üìä Import Status</h3>
                <div id="importStatus">Ready to import data...</div>
                <div id="importProgress" style="margin-top: 15px;"></div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="tab-content">
            <div class="card">
                <h3>üìà Weight Trend Analysis</h3>
                <div class="chart-container">
                    <canvas id="weightTrendChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3>üîó Health Correlations</h3>
                <div class="correlations" id="correlationsContainer">
                    <!-- Correlations will be generated dynamically -->
                </div>
            </div>

            <div class="card">
                <h3>üìä Monthly Statistics</h3>
                <table class="data-table" id="monthlyStatsTable">
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>Avg Weight</th>
                            <th>Avg Steps</th>
                            <th>Avg Sleep</th>
                            <th>Avg Calories</th>
                        </tr>
                    </thead>
                    <tbody id="monthlyStatsBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Export Tab -->
        <div id="export" class="tab-content">
            <div class="export-options">
                <h3>üíæ Export Your Data</h3>
                <p>Download your health data in various formats</p>
                
                <button class="btn" onclick="exportToCSV()">üìÑ Export as CSV</button>
                <button class="btn" onclick="exportToJSON()">üóÇÔ∏è Export as JSON</button>
                <button class="btn" onclick="generateReport()">üìã Generate PDF Report</button>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label for="dateRangeStart">Date Range Start</label>
                    <input type="date" id="dateRangeStart">
                </div>
                <div class="form-group">
                    <label for="dateRangeEnd">Date Range End</label>
                    <input type="date" id="dateRangeEnd">
                </div>
            </div>

            <div class="card">
                <h3>üîÑ Data Management</h3>
                <button class="btn btn-secondary" onclick="backupData()">üíæ Backup All Data</button>
                <button class="btn btn-secondary" onclick="restoreData()">üì• Restore Data</button>
                <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
                <input type="file" id="restoreFile" accept=".json" style="display: none;" onchange="handleDataRestore(event)">
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let healthData = {
            weight: [],
            activities: [],
            nutrition: [],
            workouts: []
        };

        // Load data from memory on page load
        function loadData() {
            // Since we can't use localStorage, data will reset on page refresh
            // In a real implementation, this would load from localStorage or a database
            initializeDashboard();
        }

        // Initialize dashboard
        function initializeDashboard() {
            updateDashboard();
            setupCharts();
            setTodayDates();
        }

        // Set today's date as default for form inputs
        function setTodayDates() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('weightDateInput').value = today;
            document.getElementById('activityDate').value = today;
            document.getElementById('nutritionDate').value = today;
            document.getElementById('workoutDate').value = today;
            document.getElementById('dateRangeEnd').value = today;
            
            // Set start date to 30 days ago
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            document.getElementById('dateRangeStart').value = thirtyDaysAgo.toISOString().split('T')[0];
        }

        // Tab switching
        function showTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Remove active class from all nav tabs
            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Update content based on tab
            if (tabName === 'dashboard') {
                updateDashboard();
            } else if (tabName === 'analytics') {
                updateAnalytics();
            }
        }

        // Add weight entry
        function addWeight() {
            const weight = parseFloat(document.getElementById('weightInput').value);
            const date = document.getElementById('weightDateInput').value;
            
            if (!weight || !date) {
                alert('Please enter both weight and date');
                return;
            }
            
            healthData.weight.push({ date, weight, timestamp: new Date() });
            healthData.weight.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            document.getElementById('weightInput').value = '';
            updateDashboard();
            alert('Weight added successfully!');
        }

        // Add activity entry
        function addActivity() {
            const steps = parseInt(document.getElementById('stepsInput').value);
            const sleep = parseFloat(document.getElementById('sleepInput').value);
            const date = document.getElementById('activityDate').value;
            
            if ((!steps && !sleep) || !date) {
                alert('Please enter at least one activity metric and date');
                return;
            }
            
            const activity = { date, timestamp: new Date() };
            if (steps) activity.steps = steps;
            if (sleep) activity.sleep = sleep;
            
            healthData.activities.push(activity);
            healthData.activities.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            document.getElementById('stepsInput').value = '';
            document.getElementById('sleepInput').value = '';
            updateDashboard();
            alert('Activity added successfully!');
        }

        // Add nutrition entry
        function addNutrition() {
            const calories = parseInt(document.getElementById('caloriesInput').value);
            const protein = parseInt(document.getElementById('proteinInput').value);
            const carbs = parseInt(document.getElementById('carbsInput').value);
            const fat = parseInt(document.getElementById('fatInput').value);
            const date = document.getElementById('nutritionDate').value;
            
            if (!calories || !date) {
                alert('Please enter calories and date');
                return;
            }
            
            const nutrition = { 
                date, 
                calories, 
                protein: protein || 0,
                carbs: carbs || 0,
                fat: fat || 0,
                timestamp: new Date() 
            };
            
            healthData.nutrition.push(nutrition);
            healthData.nutrition.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // Clear form
            document.getElementById('caloriesInput').value = '';
            document.getElementById('proteinInput').value = '';
            document.getElementById('carbsInput').value = '';
            document.getElementById('fatInput').value = '';
            updateDashboard();
            alert('Nutrition data added successfully!');
        }

        // Add workout entry
        function addWorkout() {
            const type = document.getElementById('workoutType').value;
            const duration = parseInt(document.getElementById('workoutDuration').value);
            const caloriesBurned = parseInt(document.getElementById('caloriesBurned').value);
            const date = document.getElementById('workoutDate').value;
            
            if (!type || !duration || !date) {
                alert('Please enter workout type, duration, and date');
                return;
            }
            
            const workout = {
                date,
                type,
                duration,
                caloriesBurned: caloriesBurned || 0,
                timestamp: new Date()
            };
            
            healthData.workouts.push(workout);
            healthData.workouts.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            document.getElementById('workoutDuration').value = '';
            document.getElementById('caloriesBurned').value = '';
            updateDashboard();
            alert('Workout added successfully!');
        }

        // Update dashboard
        function updateDashboard() {
            updateCurrentWeight();
            updateSteps();
            updateSleep();
            updateCalories();
            updateCharts();
        }

        function updateCurrentWeight() {
            if (healthData.weight.length > 0) {
                const latest = healthData.weight[healthData.weight.length - 1];
                document.getElementById('currentWeight').textContent = latest.weight + ' kg';
                document.getElementById('weightDate').textContent = new Date(latest.date).toLocaleDateString();
            }
        }

        function updateSteps() {
            const today = new Date().toISOString().split('T')[0];
            const todayActivity = healthData.activities.find(a => a.date === today);
            const steps = todayActivity?.steps || 0;
            
            document.getElementById('todaySteps').textContent = steps.toLocaleString();
            
            // Update progress ring
            const progress = Math.min(steps / 10000, 1) * 283;
            const progressRing = document.getElementById('stepsProgress');
            if (progressRing) {
                progressRing.style.strokeDashoffset = 283 - progress;
                progressRing.style.stroke = steps >= 10000 ? '#48bb78' : '#5a67d8';
            }
        }

        function updateSleep() {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toISOString().split('T')[0];
            
            const lastSleep = healthData.activities.find(a => a.date === yesterdayStr)?.sleep || 0;
            document.getElementById('lastSleep').textContent = lastSleep + ' hrs';
            
            // Calculate average sleep
            const sleepData = healthData.activities.filter(a => a.sleep).map(a => a.sleep);
            const avgSleep = sleepData.length > 0 ? (sleepData.reduce((a, b) => a + b, 0) / sleepData.length).toFixed(1) : 0;
            document.getElementById('avgSleep').textContent = avgSleep + ' hrs';
        }

        function updateCalories() {
            const today = new Date().toISOString().split('T')[0];
            const todayNutrition = healthData.nutrition.find(n => n.date === today);
            const todayWorkouts = healthData.workouts.filter(w => w.date === today);
            
            const caloriesIn = todayNutrition?.calories || 0;
            const caloriesOut = todayWorkouts.reduce((total, workout) => total + (workout.caloriesBurned || 0), 0);
            const netCalories = caloriesIn - caloriesOut;
            
            document.getElementById('caloriesIn').textContent = caloriesIn;
            document.getElementById('caloriesOut').textContent = caloriesOut;
            document.getElementById('netCalories').textContent = netCalories;
            document.getElementById('netCalories').className = netCalories > 0 ? 'positive' : netCalories < 0 ? 'negative' : 'neutral';
        }

        // Setup and update charts
        let weightChart, weeklyChart, weightTrendChart;

        function setupCharts() {
            // Weight chart (small version in dashboard)
            const weightCtx = document.getElementById('weightChart');
            if (weightCtx) {
                weightChart = new Chart(weightCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Weight',
                            data: [],
                            borderColor: '#5a67d8',
                            backgroundColor: 'rgba(90, 103, 216, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            x: { display: false },
                            y: { display: true, grid: { display: false } }
                        }
                    }
                });
            }

            // Weekly overview chart
            const weeklyCtx = document.getElementById('weeklyChart');
            if (weeklyCtx) {
                weeklyChart = new Chart(weeklyCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        datasets: [{
                            label: 'Steps',
                            data: [],
                            backgroundColor: 'rgba(90, 103, 216, 0.8)',
                            yAxisID: 'y'
                        }, {
                            label: 'Sleep (hrs)',
                            data: [],
                            backgroundColor: 'rgba(102, 126, 234, 0.8)',
                            yAxisID: 'y1'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: { display: true, text: 'Steps' }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: { display: true, text: 'Sleep (hrs)' },
                                grid: { drawOnChartArea: false }
                            }
                        }
                    }
                });
            }

            // Weight trend chart (analytics)
            const trendCtx = document.getElementById('weightTrendChart');
            if (trendCtx) {
                weightTrendChart = new Chart(trendCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Weight (kg)',
                            data: [],
                            borderColor: '#5a67d8',
                            backgroundColor: 'rgba(90, 103, 216, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: { display: true, text: 'Weight Trend Over Time' }
                        },
                        scales: {
                            x: { title: { display: true, text: 'Date' } },
                            y: { title: { display: true, text: 'Weight (kg)' } }
                        }
                    }
                });
            }
        }

        function updateCharts() {
            // Update weight chart
            if (weightChart && healthData.weight.length > 0) {
                const last30Days = healthData.weight.slice(-30);
                weightChart.data.labels = last30Days.map(w => new Date(w.date).toLocaleDateString());
                weightChart.data.datasets[0].data = last30Days.map(w => w.weight);
                weightChart.update();
            }

            // Update weekly chart
            if (weeklyChart) {
                const weekData = getWeeklyData();
                weeklyChart.data.datasets[0].data = weekData.steps;
                weeklyChart.data.datasets[1].data = weekData.sleep;
                weeklyChart.update();
            }

            // Update weight trend chart
            if (weightTrendChart && healthData.weight.length > 0) {
                weightTrendChart.data.labels = healthData.weight.map(w => new Date(w.date).toLocaleDateString());
                weightTrendChart.data.datasets[0].data = healthData.weight.map(w => w.weight);
                weightTrendChart.update();
            }
        }

        function getWeeklyData() {
            const today = new Date();
            const weekData = { steps: [], sleep: [] };
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                const dayActivity = healthData.activities.find(a => a.date === dateStr);
                weekData.steps.push(dayActivity?.steps || 0);
                weekData.sleep.push(dayActivity?.sleep || 0);
            }
            
            return weekData;
        }

        // Analytics functions
        function updateAnalytics() {
            updateCorrelations();
            updateMonthlyStats();
        }

        function updateCorrelations() {
            const container = document.getElementById('correlationsContainer');
            if (!container) return;

            const correlations = calculateCorrelations();
            container.innerHTML = '';

            correlations.forEach(corr => {
                const div = document.createElement('div');
                div.className = 'correlation-item';
                div.innerHTML = `
                    <h4>${corr.name}</h4>
                    <div class="correlation-value ${corr.strength}">${corr.value}</div>
                    <p>${corr.description}</p>
                `;
                container.appendChild(div);
            });
        }

        function calculateCorrelations() {
            // Simple correlation calculations
            const correlations = [];
            
            // Weight vs Sleep correlation
            const weightSleepCorr = calculatePearsonCorrelation(
                healthData.weight.map(w => w.weight),
                healthData.weight.map(w => {
                    const activity = healthData.activities.find(a => a.date === w.date);
                    return activity?.sleep || 0;
                }).filter(s => s > 0)
            );
            
            if (!isNaN(weightSleepCorr)) {
                correlations.push({
                    name: 'Weight vs Sleep',
                    value: weightSleepCorr.toFixed(2),
                    strength: Math.abs(weightSleepCorr) > 0.5 ? 'positive' : Math.abs(weightSleepCorr) > 0.3 ? 'neutral' : 'negative',
                    description: weightSleepCorr > 0 ? 'Better sleep correlates with higher weight' : 'Better sleep correlates with lower weight'
                });
            }

            // Weight vs Steps correlation
            const weightStepsCorr = calculatePearsonCorrelation(
                healthData.weight.map(w => w.weight),
                healthData.weight.map(w => {
                    const activity = healthData.activities.find(a => a.date === w.date);
                    return activity?.steps || 0;
                }).filter(s => s > 0)
            );
            
            if (!isNaN(weightStepsCorr)) {
                correlations.push({
                    name: 'Weight vs Steps',
                    value: weightStepsCorr.toFixed(2),
                    strength: Math.abs(weightStepsCorr) > 0.5 ? (weightStepsCorr > 0 ? 'negative' : 'positive') : 'neutral',
                    description: weightStepsCorr < 0 ? 'More steps correlate with lower weight' : 'More steps correlate with higher weight'
                });
            }

            return correlations;
        }

        function calculatePearsonCorrelation(x, y) {
            if (x.length !== y.length || x.length < 2) return NaN;
            
            const n = x.length;
            const sumX = x.reduce((a, b) => a + b, 0);
            const sumY = y.reduce((a, b) => a + b, 0);
            const sumXY = x.reduce((sum, xi, i) => sum + xi * y[i], 0);
            const sumX2 = x.reduce((sum, xi) => sum + xi * xi, 0);
            const sumY2 = y.reduce((sum, yi) => sum + yi * yi, 0);
            
            const numerator = n * sumXY - sumX * sumY;
            const denominator = Math.sqrt((n * sumX2 - sumX * sumX) * (n * sumY2 - sumY * sumY));
            
            return denominator === 0 ? 0 : numerator / denominator;
        }

        function updateMonthlyStats() {
            const tbody = document.getElementById('monthlyStatsBody');
            if (!tbody) return;

            const monthlyData = calculateMonthlyStats();
            tbody.innerHTML = '';

            monthlyData.forEach(month => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${month.month}</td>
                    <td>${month.avgWeight}</td>
                    <td>${month.avgSteps}</td>
                    <td>${month.avgSleep}</td>
                    <td>${month.avgCalories}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function calculateMonthlyStats() {
            const months = {};
            
            // Group data by month
            healthData.weight.forEach(w => {
                const month = w.date.substring(0, 7);
                if (!months[month]) months[month] = { weight: [], steps: [], sleep: [], calories: [] };
                months[month].weight.push(w.weight);
            });

            healthData.activities.forEach(a => {
                const month = a.date.substring(0, 7);
                if (!months[month]) months[month] = { weight: [], steps: [], sleep: [], calories: [] };
                if (a.steps) months[month].steps.push(a.steps);
                if (a.sleep) months[month].sleep.push(a.sleep);
            });

            healthData.nutrition.forEach(n => {
                const month = n.date.substring(0, 7);
                if (!months[month]) months[month] = { weight: [], steps: [], sleep: [], calories: [] };
                months[month].calories.push(n.calories);
            });

            // Calculate averages
            return Object.keys(months).map(month => ({
                month: new Date(month + '-01').toLocaleDateString('en-US', { year: 'numeric', month: 'long' }),
                avgWeight: months[month].weight.length > 0 ? (months[month].weight.reduce((a, b) => a + b, 0) / months[month].weight.length).toFixed(1) + ' kg' : '--',
                avgSteps: months[month].steps.length > 0 ? Math.round(months[month].steps.reduce((a, b) => a + b, 0) / months[month].steps.length).toLocaleString() : '--',
                avgSleep: months[month].sleep.length > 0 ? (months[month].sleep.reduce((a, b) => a + b, 0) / months[month].sleep.length).toFixed(1) + ' hrs' : '--',
                avgCalories: months[month].calories.length > 0 ? Math.round(months[month].calories.reduce((a, b) => a + b, 0) / months[month].calories.length) : '--'
            })).reverse();
        }

        // Import functions
        function handleAppleHealthImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            document.getElementById('importStatus').textContent = 'Processing Apple Health data...';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    parseAppleHealthXML(e.target.result);
                    document.getElementById('importStatus').textContent = 'Apple Health data imported successfully!';
                } catch (error) {
                    document.getElementById('importStatus').textContent = 'Error parsing Apple Health data: ' + error.message;
                }
            };
            reader.readAsText(file);
        }

        function parseAppleHealthXML(xmlString) {
            // Basic XML parsing for Apple Health data
            // This is a simplified version - real implementation would be more robust
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlString, "text/xml");
            
            // Parse weight records
            const weightRecords = xmlDoc.querySelectorAll('Record[type="HKQuantityTypeIdentifierBodyMass"]');
            weightRecords.forEach(record => {
                const date = record.getAttribute('startDate').split(' ')[0];
                const weight = parseFloat(record.getAttribute('value'));
                
                if (!healthData.weight.find(w => w.date === date)) {
                    healthData.weight.push({ date, weight, timestamp: new Date() });
                }
            });

            // Parse step records
            const stepRecords = xmlDoc.querySelectorAll('Record[type="HKQuantityTypeIdentifierStepCount"]');
            const stepsByDate = {};
            stepRecords.forEach(record => {
                const date = record.getAttribute('startDate').split(' ')[0];
                const steps = parseInt(record.getAttribute('value'));
                stepsByDate[date] = (stepsByDate[date] || 0) + steps;
            });

            Object.keys(stepsByDate).forEach(date => {
                const existingActivity = healthData.activities.find(a => a.date === date);
                if (existingActivity) {
                    existingActivity.steps = stepsByDate[date];
                } else {
                    healthData.activities.push({ date, steps: stepsByDate[date], timestamp: new Date() });
                }
            });

            // Parse sleep records
            const sleepRecords = xmlDoc.querySelectorAll('Record[type="HKCategoryTypeIdentifierSleepAnalysis"]');
            const sleepByDate = {};
            sleepRecords.forEach(record => {
                const startDate = new Date(record.getAttribute('startDate'));
                const endDate = new Date(record.getAttribute('endDate'));
                const duration = (endDate - startDate) / (1000 * 60 * 60); // hours
                const date = startDate.toISOString().split('T')[0];
                
                sleepByDate[date] = (sleepByDate[date] || 0) + duration;
            });

            Object.keys(sleepByDate).forEach(date => {
                const existingActivity = healthData.activities.find(a => a.date === date);
                if (existingActivity) {
                    existingActivity.sleep = sleepByDate[date];
                } else {
                    healthData.activities.push({ date, sleep: sleepByDate[date], timestamp: new Date() });
                }
            });

            // Sort arrays by date
            healthData.weight.sort((a, b) => new Date(a.date) - new Date(b.date));
            healthData.activities.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            updateDashboard();
        }

        function handleNutritionImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            document.getElementById('importStatus').textContent = 'Processing nutrition data...';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    parseNutritionCSV(e.target.result);
                    document.getElementById('importStatus').textContent = 'Nutrition data imported successfully!';
                } catch (error) {
                    document.getElementById('importStatus').textContent = 'Error parsing nutrition data: ' + error.message;
                }
            };
            reader.readAsText(file);
        }

        function parseNutritionCSV(csvString) {
            const lines = csvString.split('\n');
            const headers = lines[0].toLowerCase().split(',').map(h => h.trim());
            
            for (let i = 1; i < lines.length; i++) {
                if (!lines[i].trim()) continue;
                
                const values = lines[i].split(',').map(v => v.trim());
                const dateIndex = headers.findIndex(h => h.includes('date'));
                const caloriesIndex = headers.findIndex(h => h.includes('calories'));
                const proteinIndex = headers.findIndex(h => h.includes('protein'));
                const carbsIndex = headers.findIndex(h => h.includes('carb'));
                const fatIndex = headers.findIndex(h => h.includes('fat'));
                
                if (dateIndex >= 0 && caloriesIndex >= 0) {
                    const date = values[dateIndex];
                    const calories = parseInt(values[caloriesIndex]) || 0;
                    const protein = parseInt(values[proteinIndex]) || 0;
                    const carbs = parseInt(values[carbsIndex]) || 0;
                    const fat = parseInt(values[fatIndex]) || 0;
                    
                    if (!healthData.nutrition.find(n => n.date === date)) {
                        healthData.nutrition.push({
                            date, calories, protein, carbs, fat,
                            timestamp: new Date()
                        });
                    }
                }
            }
            
            healthData.nutrition.sort((a, b) => new Date(a.date) - new Date(b.date));
            updateDashboard();
        }

        // Export functions
        function exportToCSV() {
            const startDate = document.getElementById('dateRangeStart').value;
            const endDate = document.getElementById('dateRangeEnd').value;
            
            let csv = 'Date,Weight,Steps,Sleep,Calories,Protein,Carbs,Fat,Workout Type,Workout Duration,Calories Burned\n';
            
            const dateRange = getDateRange(startDate, endDate);
            dateRange.forEach(date => {
                const weight = healthData.weight.find(w => w.date === date)?.weight || '';
                const activity = healthData.activities.find(a => a.date === date);
                const nutrition = healthData.nutrition.find(n => n.date === date);
                const workout = healthData.workouts.find(w => w.date === date);
                
                csv += `${date},${weight},${activity?.steps || ''},${activity?.sleep || ''},`;
                csv += `${nutrition?.calories || ''},${nutrition?.protein || ''},${nutrition?.carbs || ''},${nutrition?.fat || ''},`;
                csv += `${workout?.type || ''},${workout?.duration || ''},${workout?.caloriesBurned || ''}\n`;
            });
            
            downloadFile(csv, 'health-data.csv', 'text/csv');
        }

        function exportToJSON() {
            const startDate = document.getElementById('dateRangeStart').value;
            const endDate = document.getElementById('dateRangeEnd').value;
            
            const filteredData = {
                weight: healthData.weight.filter(w => w.date >= startDate && w.date <= endDate),
                activities: healthData.activities.filter(a => a.date >= startDate && a.date <= endDate),
                nutrition: healthData.nutrition.filter(n => n.date >= startDate && n.date <= endDate),
                workouts: healthData.workouts.filter(w => w.date >= startDate && w.date <= endDate)
            };
            
            const json = JSON.stringify(filteredData, null, 2);
            downloadFile(json, 'health-data.json', 'application/json');
        }

        function generateReport() {
            // Generate a simple HTML report
            const startDate = document.getElementById('dateRangeStart').value;
            const endDate = document.getElementById('dateRangeEnd').value;
            
            const report = `
                <html>
                <head><title>Health Report</title></head>
                <body style="font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px;">
                    <h1>Health & Fitness Report</h1>
                    <p><strong>Period:</strong> ${startDate} to ${endDate}</p>
                    
                    <h2>Summary</h2>
                    <p><strong>Total Weight Entries:</strong> ${healthData.weight.length}</p>
                    <p><strong>Total Activity Days:</strong> ${healthData.activities.length}</p>
                    <p><strong>Total Nutrition Entries:</strong> ${healthData.nutrition.length}</p>
                    <p><strong>Total Workouts:</strong> ${healthData.workouts.length}</p>
                    
                    <h2>Latest Metrics</h2>
                    <p><strong>Current Weight:</strong> ${healthData.weight.length > 0 ? healthData.weight[healthData.weight.length - 1].weight + ' kg' : 'No data'}</p>
                    <p><strong>Average Daily Steps:</strong> ${calculateAverageSteps()}</p>
                    <p><strong>Average Sleep:</strong> ${calculateAverageSleep()} hours</p>
                    
                    <p><em>Generated on ${new Date().toLocaleDateString()}</em></p>
                </body>
                </html>
            `;
            
            downloadFile(report, 'health-report.html', 'text/html');
        }

        function calculateAverageSteps() {
            const stepsData = healthData.activities.filter(a => a.steps).map(a => a.steps);
            return stepsData.length > 0 ? Math.round(stepsData.reduce((a, b) => a + b, 0) / stepsData.length).toLocaleString() : 'No data';
        }

        function calculateAverageSleep() {
            const sleepData = healthData.activities.filter(a => a.sleep).map(a => a.sleep);
            return sleepData.length > 0 ? (sleepData.reduce((a, b) => a + b, 0) / sleepData.length).toFixed(1) : 'No data';
        }

        function getDateRange(startDate, endDate) {
            const dates = [];
            const currentDate = new Date(startDate);
            const end = new Date(endDate);
            
            while (currentDate <= end) {
                dates.push(currentDate.toISOString().split('T')[0]);
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            return dates;
        }

        function downloadFile(content, filename, contentType) {
            const blob = new Blob([content], { type: contentType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Data management functions
        function backupData() {
            const backup = {
                data: healthData,
                timestamp: new Date().toISOString(),
                version: '1.0'
            };
            
            const json = JSON.stringify(backup, null, 2);
            downloadFile(json, `health-backup-${new Date().toISOString().split('T')[0]}.json`, 'application/json');
            alert('Data backup downloaded successfully!');
        }

        function restoreData() {
            document.getElementById('restoreFile').click();
        }

        function handleDataRestore(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backup = JSON.parse(e.target.result);
                    if (backup.data) {
                        healthData = backup.data;
                        updateDashboard();
                        updateAnalytics();
                        alert('Data restored successfully!');
                    } else {
                        alert('Invalid backup file format');
                    }
                } catch (error) {
                    alert('Error restoring data: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear all data? This action cannot be undone.')) {
                healthData = { weight: [], activities: [], nutrition: [], workouts: [] };
                updateDashboard();
                updateAnalytics();
                alert('All data cleared successfully!');
            }
        }

        // Initialize app on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });
    </script>
</body>
</html>